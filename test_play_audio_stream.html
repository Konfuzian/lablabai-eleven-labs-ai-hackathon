<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Playing audio with streaming turned on</title>
</head>
<body>
	<section data-player>
		<button type="button" data-player-play>Play text</button>
		<br />
		<audio data-player-output controls></audio>
	</div>

	<script type="text/javascript">
		function playText() {
			const voice_id = '21m00Tcm4TlvDq8ikWAM';
			const text = 'call me baby, she said seductively';

			const tts_url = `https://api.elevenlabs.io/v1/text-to-speech/${voice_id}/stream`;

			const headers = {
			  "Content-Type": "application/json",
			  "xi-api-key": "a5c043e13ce68da1077daa5cb776c59b"
			};

			const data = {
			  text: text,
			  model_id: "eleven_monolingual_v1",
			  voice_settings: {
			    stability: 0.5,
			    similarity_boost: 0.5
			  }
			};


			fetch(tts_url, { method: 'POST', body: JSON.stringify(data), headers: headers })
			  .then(response => response.blob())
			  .then(blob => {
			    let url = window.URL.createObjectURL(blob);
			    let audio = document.querySelector('[data-player-output]');
			    audio.src = url;
			    audio.play();
			  })
			  .catch(error => console.error(error));
		}

		document.querySelectorAll("[data-player]").forEach(el => {
			const play = el.querySelector("[data-player-play]");

			play.addEventListener("click", e => {
				playText()
			})
		})
	</script>

</body>
</html>
